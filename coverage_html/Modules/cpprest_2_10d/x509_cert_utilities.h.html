<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>x509_cert_utilities.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
/***
 * Copyright (C) Microsoft. All rights reserved.
 * Licensed under the MIT license. See LICENSE.txt file in the project root for full license information.
 *
 * =+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
 *
 * Contains utility functions for helping to verify server certificates in OS X/iOS and Android.
 *
 * For the latest on this and related APIs, please see: https://github.com/Microsoft/cpprestsdk
 *
 * =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
 ****/

#pragma once

#if defined(_WIN32)
#include &lt;Wincrypt.h&gt;

namespace web
{
namespace http
{
namespace client
{
namespace details
{
struct winhttp_cert_context
{
    PCCERT_CONTEXT raw;
<span style = "background-color:#fdd">    winhttp_cert_context() CPPREST_NOEXCEPT : raw(nullptr) {}</span>
    winhttp_cert_context(const winhttp_cert_context&amp;) = delete;
    winhttp_cert_context&amp; operator=(const winhttp_cert_context&amp;) = delete;
    ~winhttp_cert_context()
<span style = "background-color:#fdd">    {</span>
        // https://docs.microsoft.com/en-us/windows/desktop/api/wincrypt/nf-wincrypt-certfreecertificatecontext
        // "The function always returns nonzero."
<span style = "background-color:#fdd">        if (raw)</span>
        {
<span style = "background-color:#fdd">            (void)CertFreeCertificateContext(raw);</span>
        }
<span style = "background-color:#fdd">    }</span>
};

struct winhttp_cert_chain_context
{
    PCCERT_CHAIN_CONTEXT raw;
<span style = "background-color:#fdd">    winhttp_cert_chain_context() CPPREST_NOEXCEPT : raw(nullptr) {}</span>
    winhttp_cert_chain_context(const winhttp_cert_chain_context&amp;) = delete;
    winhttp_cert_chain_context&amp; operator=(const winhttp_cert_chain_context&amp;) = delete;
    ~winhttp_cert_chain_context()
<span style = "background-color:#fdd">    {
        if (raw)</span>
        {
<span style = "background-color:#fdd">            CertFreeCertificateChain(raw);</span>
        }
<span style = "background-color:#fdd">    }</span>
};
} // namespace details
} // namespace client
} // namespace http
} // namespace web
#endif // _WIN32

#if defined(__APPLE__) || (defined(ANDROID) || defined(__ANDROID__)) ||                                                \
    (defined(_WIN32) &amp;&amp; defined(CPPREST_FORCE_HTTP_CLIENT_ASIO)) ||                                                    \
    (defined(_WIN32) &amp;&amp; !defined(__cplusplus_winrt) &amp;&amp; !defined(_M_ARM) &amp;&amp; !defined(CPPREST_EXCLUDE_WEBSOCKETS))
#define CPPREST_PLATFORM_ASIO_CERT_VERIFICATION_AVAILABLE
#endif

#ifdef CPPREST_PLATFORM_ASIO_CERT_VERIFICATION_AVAILABLE
#include &lt;string&gt;

#if defined(_MSC_VER)
#pragma warning(push)
#pragma warning(disable : 4005)
#endif
#if defined(__clang__)
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wunused-local-typedef"
#endif
#include &lt;boost/asio/ssl.hpp&gt;
#if defined(__clang__)
#pragma clang diagnostic pop
#endif
#if defined(_MSC_VER)
#pragma warning(pop)
#endif

namespace web
{
namespace http
{
namespace client
{
namespace details
{
/// &lt;summary&gt;
/// Using platform specific APIs verifies server certificate.
/// Currently implemented to work on Windows, iOS, Android, and OS X.
/// &lt;/summary&gt;
/// &lt;param name="verifyCtx"&gt;Boost.ASIO context to get certificate chain from.&lt;/param&gt;
/// &lt;param name="hostName"&gt;Host name from the URI.&lt;/param&gt;
/// &lt;returns&gt;True if verification passed and server can be trusted, false otherwise.&lt;/returns&gt;
bool verify_cert_chain_platform_specific(boost::asio::ssl::verify_context&amp; verifyCtx, const std::string&amp; hostName);
} // namespace details
} // namespace client
} // namespace http
} // namespace web

#endif // CPPREST_PLATFORM_ASIO_CERT_VERIFICATION_AVAILABLE</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>